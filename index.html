<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خريطة الطقس التفاعلية العالمية - مدعومة بالذكاء الاصطناعي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .section-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .section-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        .ai-chat-container {
            max-height: 400px;
            overflow-y: auto;
        }
        .message-bubble {
            max-width: 80%;
            word-wrap: break-word;
        }
        .user-message {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            margin-left: auto;
        }
        .ai-message {
            background: linear-gradient(135deg, #10b981, #059669);
            margin-right: auto;
        }
        .typing-indicator {
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        .weather-animation {
            animation: weatherPulse 3s ease-in-out infinite;
        }
        @keyframes weatherPulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        .satellite-indicator {
            animation: satelliteBlink 1.5s ease-in-out infinite;
        }
        @keyframes satelliteBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .nav-tab {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .nav-tab.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            transform: translateY(-2px);
        }
        .section-content {
            display: none;
        }
        .section-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 min-h-screen text-white">
    <!-- Header -->
    <header class="bg-black bg-opacity-30 backdrop-blur-md p-4 border-b border-white border-opacity-20 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4 space-x-reverse">
                <div class="w-12 h-12 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                    <span class="text-2xl">🌍</span>
                </div>
                <div>
                    <h1 class="text-xl font-bold">خريطة الطقس التفاعلية العالمية 🌍</h1>
                    <p class="text-blue-200 text-sm">مراقبة شاملة للبيئة والطقس عالمياً مع ChatGPT و Gemini AI</p>
                </div>
            </div>
            <div class="flex items-center space-x-4 space-x-reverse">
                <div class="bg-green-600 px-3 py-1 rounded-full text-sm" id="userPoints">
                    🏆 نقاطك: 1,250
                </div>
                <div class="text-sm text-green-300">
                    <span class="inline-block w-2 h-2 bg-green-400 rounded-full mr-2 satellite-indicator"></span>
                    ChatGPT + Gemini AI متصل
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="max-w-7xl mx-auto p-4">
        <div class="flex flex-wrap gap-2 justify-center">
            <button class="nav-tab active px-6 py-3 rounded-xl font-medium" data-section="satellite">
                🛰 الأقمار الصناعية
            </button>
            <button class="nav-tab px-6 py-3 rounded-xl font-medium" data-section="map">
                🗺 الخريطة التفاعلية
            </button>
            <button class="nav-tab px-6 py-3 rounded-xl font-medium" data-section="ai-chat">
                🤖 مساعد الطقس الذكي
            </button>
            <button class="nav-tab px-6 py-3 rounded-xl font-medium" data-section="analytics">
                📊 التحليلات والإحصائيات
            </button>
            <button class="nav-tab px-6 py-3 rounded-xl font-medium" data-section="carbon">
                🌱 حاسبة الكربون
            </button>
            <button class="nav-tab px-6 py-3 rounded-xl font-medium" data-section="community">
                👥 المجتمع والملاحظات
            </button>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-4">
        <!-- Section 1: Satellite Data -->
        <div id="satellite" class="section-content active">
            <div class="section-card rounded-2xl p-6 mb-6">
                <h2 class="text-2xl font-bold mb-6 text-center">🛰 بيانات الأقمار الصناعية المباشرة</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
                    <!-- Satellite Controls -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-4">
                        <h3 class="font-bold mb-3">نوع القمر الصناعي</h3>
                        <div class="space-y-3">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="satelliteView" value="radar" checked class="ml-2">
                                <span class="text-sm">🌧 رادار الأمطار</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="satelliteView" value="clouds" class="ml-2">
                                <span class="text-sm">☁ الغيوم المطيرة</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="satelliteView" value="infrared" class="ml-2">
                                <span class="text-sm">🌡 الأشعة تحت الحمراء</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="satelliteView" value="visible" class="ml-2">
                                <span class="text-sm">👁 الضوء المرئي</span>
                            </label>
                        </div>
                    </div>

                    <!-- Real-time AI Predictions -->
                    <div class="bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl p-4">
                        <h3 class="font-bold mb-3">🤖 توقعات الذكاء الاصطناعي</h3>
                        <div id="aiPredictions" class="space-y-3">
                            <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium">لندن 🇬🇧</span>
                                    <span class="text-xs bg-red-500 px-2 py-1 rounded-full">68%</span>
                                </div>
                                <div class="text-xs text-red-200">🌧 أمطار خفيفة خلال 4 ساعات</div>
                                <div class="text-xs opacity-60 mt-1">مناخ معتدل</div>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium">الرياض 🇸🇦</span>
                                    <span class="text-xs bg-green-500 px-2 py-1 rounded-full">8%</span>
                                </div>
                                <div class="text-xs text-green-200">☀ طقس مستقر خلال اليوم</div>
                                <div class="text-xs opacity-60 mt-1">مناخ صحراوي</div>
                            </div>
                        </div>
                        <button id="refreshPredictions" class="w-full mt-3 bg-white bg-opacity-20 hover:bg-opacity-30 py-2 rounded-lg text-sm transition-colors">
                            🔄 تحديث التوقعات
                        </button>
                    </div>

                    <!-- Weather Alerts -->
                    <div class="bg-gradient-to-br from-red-600 to-orange-600 rounded-xl p-4">
                        <h3 class="font-bold mb-3">⚠ تنبيهات جوية عاجلة</h3>
                        <div id="weatherAlerts" class="space-y-2 text-sm">
                            <div class="flex items-center text-red-200">
                                <span class="w-2 h-2 bg-red-400 rounded-full ml-2 animate-pulse"></span>
                                عاصفة رعدية قادمة - لندن 🇬🇧
                            </div>
                            <div class="flex items-center text-yellow-200">
                                <span class="w-2 h-2 bg-yellow-400 rounded-full ml-2"></span>
                                موجة حر شديدة - دبي 🇦🇪
                            </div>
                            <div class="flex items-center text-blue-200">
                                <span class="w-2 h-2 bg-blue-400 rounded-full ml-2"></span>
                                رياح قوية - سيدني 🇦🇺
                            </div>
                        </div>
                    </div>

                    <!-- NASA Satellite Status -->
                    <div class="bg-gradient-to-br from-green-600 to-teal-600 rounded-xl p-4">
                        <h3 class="font-bold mb-3">🛰 أقمار ناسا الصناعية</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm">Terra MODIS</span>
                                <span class="text-xs bg-green-500 px-2 py-1 rounded-full">نشط</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">Aqua MODIS</span>
                                <span class="text-xs bg-green-500 px-2 py-1 rounded-full">نشط</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">GOES-16/17</span>
                                <span class="text-xs bg-green-500 px-2 py-1 rounded-full">نشط</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm">Landsat 8/9</span>
                                <span class="text-xs bg-green-500 px-2 py-1 rounded-full">نشط</span>
                            </div>
                            <div class="text-xs text-green-200 mt-3">
                                مصدر البيانات: <strong>NASA Worldview</strong>
                                <br>آخر تحديث: <span id="lastUpdate">منذ 15 دقيقة</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NASA Satellite Image Display -->
                <div class="bg-black bg-opacity-30 rounded-xl p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold">🛰 صور ناسا الفضائية المباشرة</h3>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23ff0000'/%3E%3Ctext x='50' y='55' text-anchor='middle' fill='white' font-size='12' font-weight='bold'%3ENASA%3C/text%3E%3C/svg%3E" alt="NASA" class="w-6 h-6">
                            <span class="text-xs text-blue-300">NASA Worldview API</span>
                        </div>
                    </div>
                    <div id="satelliteImage" class="h-64 bg-gradient-to-br from-blue-800 to-purple-800 rounded-lg flex items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 opacity-30">
                            <div class="w-full h-full bg-gradient-radial from-white via-transparent to-transparent animate-pulse"></div>
                        </div>
                        <div class="text-center z-10">
                            <div class="text-4xl mb-2">🌍</div>
                            <div class="text-lg font-bold">صور الأرض من الفضاء</div>
                            <div class="text-sm opacity-80">Terra & Aqua MODIS - تحديث كل 15 دقيقة</div>
                            <div class="text-xs opacity-60 mt-2">دقة: 250 متر - تغطية عالمية</div>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-center opacity-70">
                        مصدر البيانات: NASA Goddard Space Flight Center
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Interactive Map -->
        <div id="map" class="section-content">
            <div class="section-card rounded-2xl p-6 mb-6">
                <h2 class="text-2xl font-bold mb-6 text-center">🗺 الخريطة التفاعلية العالمية</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white bg-opacity-10 rounded-xl p-4">
                        <h3 class="font-bold mb-3">طبقات الخريطة</h3>
                        <div class="space-y-2">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="mapView" value="temperature" checked class="ml-2">
                                <span class="text-sm">🌡 درجة الحرارة</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="mapView" value="pollution" class="ml-2">
                                <span class="text-sm">💨 مستوى التلوث</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="mapView" value="humidity" class="ml-2">
                                <span class="text-sm">💧 الرطوبة</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="mapView" value="wind" class="ml-2">
                                <span class="text-sm">🌪 سرعة الرياح</span>
                            </label>
                        </div>
                    </div>

                    <div class="bg-white bg-opacity-10 rounded-xl p-4">
                        <h3 class="font-bold mb-3">اختر المدينة</h3>
                        <select id="globalCitySelector" class="w-full bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg px-3 py-2 text-white text-sm mb-3">
                            <optgroup label="الشرق الأوسط">
                                <option value="القاهرة">القاهرة 🇪🇬</option>
                                <option value="دبي">دبي 🇦🇪</option>
                                <option value="الرياض">الرياض 🇸🇦</option>
                                <option value="إسطنبول">إسطنبول 🇹🇷</option>
                                <option value="بيروت">بيروت 🇱🇧</option>
                                <option value="الكويت">الكويت 🇰🇼</option>
                            </optgroup>
                            <optgroup label="أوروبا">
                                <option value="لندن">لندن 🇬🇧</option>
                                <option value="باريس">باريس 🇫🇷</option>
                                <option value="برلين">برلين 🇩🇪</option>
                                <option value="روما">روما 🇮🇹</option>
                                <option value="مدريد">مدريد 🇪🇸</option>
                                <option value="أمستردام">أمستردام 🇳🇱</option>
                            </optgroup>
                            <optgroup label="آسيا">
                                <option value="طوكيو">طوكيو 🇯🇵</option>
                                <option value="بكين">بكين 🇨🇳</option>
                                <option value="مومباي">مومباي 🇮🇳</option>
                                <option value="سنغافورة">سنغافورة 🇸🇬</option>
                                <option value="سيول">سيول 🇰🇷</option>
                                <option value="بانكوك">بانكوك 🇹🇭</option>
                            </optgroup>
                            <optgroup label="الأمريكتان">
                                <option value="نيويورك">نيويورك 🇺🇸</option>
                                <option value="لوس أنجلوس">لوس أنجلوس 🇺🇸</option>
                                <option value="تورونتو">تورونتو 🇨🇦</option>
                                <option value="ساو باولو">ساو باولو 🇧🇷</option>
                                <option value="مكسيكو سيتي">مكسيكو سيتي 🇲🇽</option>
                                <option value="بوينس آيرس">بوينس آيرس 🇦🇷</option>
                            </optgroup>
                            <optgroup label="أفريقيا وأوقيانوسيا">
                                <option value="كيب تاون">كيب تاون 🇿🇦</option>
                                <option value="لاغوس">لاغوس 🇳🇬</option>
                                <option value="نيروبي">نيروبي 🇰🇪</option>
                                <option value="سيدني">سيدني 🇦🇺</option>
                                <option value="ملبورن">ملبورن 🇦🇺</option>
                                <option value="أوكلاند">أوكلاند 🇳🇿</option>
                            </optgroup>
                        </select>
                        <select id="timeRange" class="w-full bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg px-3 py-2 text-white text-sm">
                            <option value="current">الآن</option>
                            <option value="forecast">توقعات 24 ساعة</option>
                            <option value="historical">مقارنة تاريخية</option>
                        </select>
                    </div>

                    <div class="bg-white bg-opacity-10 rounded-xl p-4">
                        <h3 class="font-bold mb-3">أدوات الخريطة</h3>
                        <div class="space-y-2">
                            <button id="addMarkerBtn" class="w-full bg-blue-600 hover:bg-blue-700 py-2 rounded-lg text-sm transition-colors">
                                📍 إضافة علامة
                            </button>
                            <button id="measureBtn" class="w-full bg-green-600 hover:bg-green-700 py-2 rounded-lg text-sm transition-colors">
                                📏 قياس المسافة
                            </button>
                        </div>
                    </div>

                    <div class="bg-white bg-opacity-10 rounded-xl p-4">
                        <h3 class="font-bold mb-3">مشاركة الخريطة</h3>
                        <div class="space-y-2">
                            <button id="shareMapBtn" class="w-full bg-purple-600 hover:bg-purple-700 py-2 rounded-lg text-sm transition-colors">
                                📤 مشاركة الرابط
                            </button>
                            <button id="exportBtn" class="w-full bg-orange-600 hover:bg-orange-700 py-2 rounded-lg text-sm transition-colors">
                                💾 تصدير البيانات
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Interactive Map Container -->
                <div id="realMap" class="h-96 rounded-xl overflow-hidden border-2 border-white border-opacity-20 mb-4"></div>

                <!-- Map Legend -->
                <div class="flex justify-center">
                    <div class="flex items-center space-x-6 space-x-reverse text-sm">
                        <div class="flex items-center">
                            <div class="w-4 h-4 bg-green-500 rounded-full ml-2"></div>
                            <span>منخفض</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-4 h-4 bg-yellow-500 rounded-full ml-2"></div>
                            <span>متوسط</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-4 h-4 bg-red-500 rounded-full ml-2"></div>
                            <span>عالي</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 3: AI Chat Assistant -->
        <div id="ai-chat" class="section-content">
            <div class="section-card rounded-2xl p-6 mb-6">
                <h2 class="text-2xl font-bold mb-6 text-center">🤖 مساعد الطقس الذكي</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Chat Interface -->
                    <div class="lg:col-span-2">
                        <div class="bg-white bg-opacity-10 rounded-xl p-4 mb-4">
                            <div class="ai-chat-container mb-4" id="chatContainer">
                                <div class="space-y-4" id="chatMessages">
                                    <div class="message-bubble ai-message p-3 rounded-lg">
                                        <div class="text-sm font-medium mb-1">🤖 مساعد الطقس</div>
                                        <div>مرحباً! أنا مساعدك الذكي للطقس. يمكنني مساعدتك في:</div>
                                        <ul class="mt-2 text-sm space-y-1">
                                            <li>• توقعات الطقس الدقيقة لأي مدينة</li>
                                            <li>• تحليل بيانات الأقمار الصناعية</li>
                                            <li>• نصائح للأنشطة حسب الطقس</li>
                                            <li>• تنبيهات الطقس الخطير</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex space-x-2 space-x-reverse">
                                <input type="text" id="chatInput" placeholder="اسأل عن الطقس في أي مدينة..." 
                                       class="flex-1 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg px-4 py-2 text-white placeholder-gray-300">
                                <button id="sendBtn" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg transition-colors">
                                    إرسال
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="space-y-4">
                        <div class="bg-white bg-opacity-10 rounded-xl p-4">
                            <h3 class="font-bold mb-3">أسئلة سريعة</h3>
                            <div class="space-y-2">
                                <button class="quick-question w-full text-right bg-white bg-opacity-10 hover:bg-opacity-20 p-2 rounded-lg text-sm transition-colors" 
                                        data-question="ما هو الطقس في لندن اليوم؟">
                                    🌤 طقس لندن اليوم
                                </button>
                                <button class="quick-question w-full text-right bg-white bg-opacity-10 hover:bg-opacity-20 p-2 rounded-lg text-sm transition-colors" 
                                        data-question="هل ستمطر في نيويورك؟">
                                    🌧 توقعات أمطار نيويورك
                                </button>
                                <button class="quick-question w-full text-right bg-white bg-opacity-10 hover:bg-opacity-20 p-2 rounded-lg text-sm transition-colors" 
                                        data-question="ما أفضل وقت للخروج اليوم؟">
                                    ⏰ أفضل وقت للخروج
                                </button>
                                <button class="quick-question w-full text-right bg-white bg-opacity-10 hover:bg-opacity-20 p-2 rounded-lg text-sm transition-colors" 
                                        data-question="نصائح للحماية من الحر">
                                    🔥 نصائح الحماية من الحر
                                </button>
                            </div>
                        </div>

                        <div class="bg-white bg-opacity-10 rounded-xl p-4">
                            <h3 class="font-bold mb-3">إعدادات الذكاء الاصطناعي</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm mb-1">نوع الإجابات</label>
                                    <select id="aiMode" class="w-full bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg px-3 py-2 text-white text-sm">
                                        <option value="detailed">مفصلة</option>
                                        <option value="simple">بسيطة</option>
                                        <option value="technical">تقنية</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm mb-1">المدينة المفضلة</label>
                                    <select id="preferredCity" class="w-full bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg px-3 py-2 text-white text-sm">
                                        <option value="القاهرة">القاهرة 🇪🇬</option>
                                        <option value="دبي">دبي 🇦🇪</option>
                                        <option value="لندن">لندن 🇬🇧</option>
                                        <option value="نيويورك">نيويورك 🇺🇸</option>
                                        <option value="طوكيو">طوكيو 🇯🇵</option>
                                        <option value="باريس">باريس 🇫🇷</option>
                                        <option value="الرياض">الرياض 🇸🇦</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-green-600 to-teal-600 rounded-xl p-4">
                            <h3 class="font-bold mb-3">🎯 دقة التوقعات</h3>
                            <div class="text-center">
                                <div class="text-3xl font-bold mb-2">94.5%</div>
                                <div class="text-sm opacity-80">دقة توقعات اليوم</div>
                                <div class="mt-3 text-xs">
                                    مدعوم بـ ChatGPT و Gemini و بيانات الأقمار الصناعية
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl p-4">
                            <h3 class="font-bold mb-3">🔧 إعداد APIs</h3>
                            <div class="text-xs space-y-2">
                                <div class="bg-white bg-opacity-20 rounded p-2">
                                    <strong>للحصول على بيانات حقيقية:</strong>
                                    <br>🤖 <strong>AI:</strong> OpenAI أو Google Gemini API
                                    <br>🛰 <strong>ناسا:</strong> NASA Worldview API
                                    <br>🌤 <strong>الطقس:</strong> OpenWeatherMap API
                                    <br><br>استبدل API Keys في الكود
                                </div>
                                <div class="text-center">
                                    <button onclick="alert('الموقع يدعم الآن:\\n• أقمار ناسا الصناعية\\n• بيانات طقس عالمية\\n• ذكاء اصطناعي متقدم\\n\\nأضف API Keys للحصول على بيانات حقيقية')" 
                                            class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1 rounded text-xs">
                                        📖 دليل الإعداد
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 4: Analytics -->
        <div id="analytics" class="section-content">
            <div class="section-card rounded-2xl p-6 mb-6">
                <h2 class="text-2xl font-bold mb-6 text-center">📊 التحليلات والإحصائيات</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Weather Comparison Chart -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">📈 مقارنة الطقس الشهرية</h3>
                        <div class="h-64">
                            <canvas id="weatherComparisonChart"></canvas>
                        </div>
                    </div>

                    <!-- Pollution Trends -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">💨 اتجاهات التلوث</h3>
                        <div class="h-64">
                            <canvas id="pollutionChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Weather Statistics -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">🌡 إحصائيات الطقس</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between">
                                <span>أعلى درجة حرارة:</span>
                                <span class="font-bold text-red-400">45°C</span>
                            </div>
                            <div class="flex justify-between">
                                <span>أقل درجة حرارة:</span>
                                <span class="font-bold text-blue-400">8°C</span>
                            </div>
                            <div class="flex justify-between">
                                <span>متوسط الرطوبة:</span>
                                <span class="font-bold text-green-400">52%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>أيام الأمطار:</span>
                                <span class="font-bold text-blue-400">12 يوم</span>
                            </div>
                        </div>
                    </div>

                    <!-- Air Quality Index -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">🫁 مؤشر جودة الهواء</h3>
                        <div class="space-y-4">
                            <div class="text-center">
                                <div class="text-4xl font-bold text-yellow-400 mb-2">156</div>
                                <div class="text-sm opacity-80">غير صحي للمجموعات الحساسة</div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>PM2.5:</span>
                                    <span>89 μg/m³</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>PM10:</span>
                                    <span>145 μg/m³</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>O₃:</span>
                                    <span>78 μg/m³</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Weather Probabilities -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">🎯 احتمالية الأحداث</h3>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>🌧 أمطار</span>
                                    <span id="rainProb">25%</span>
                                </div>
                                <div class="w-full bg-white bg-opacity-20 rounded-full h-2">
                                    <div class="h-full bg-blue-400 rounded-full transition-all duration-500" style="width: 25%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>🌪 رياح قوية</span>
                                    <span id="windProb">60%</span>
                                </div>
                                <div class="w-full bg-white bg-opacity-20 rounded-full h-2">
                                    <div class="h-full bg-yellow-400 rounded-full transition-all duration-500" style="width: 60%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>🔥 موجة حر</span>
                                    <span id="heatProb">85%</span>
                                </div>
                                <div class="w-full bg-white bg-opacity-20 rounded-full h-2">
                                    <div class="h-full bg-red-400 rounded-full transition-all duration-500" style="width: 85%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 5: Carbon Calculator -->
        <div id="carbon" class="section-content">
            <div class="section-card rounded-2xl p-6 mb-6">
                <h2 class="text-2xl font-bold mb-6 text-center">🌱 حاسبة البصمة الكربونية</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Carbon Calculator -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">🚗 حساب انبعاثات المواصلات</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">وسيلة المواصلات</label>
                                <select id="transportMode" class="w-full bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg px-3 py-2 text-white">
                                    <option value="car">سيارة خاصة</option>
                                    <option value="bus">أتوبيس</option>
                                    <option value="metro">مترو</option>
                                    <option value="bike">دراجة</option>
                                    <option value="walk">مشي</option>
                                    <option value="plane">طائرة</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">المسافة (كيلومتر)</label>
                                <input type="number" id="distance" placeholder="أدخل المسافة" 
                                       class="w-full bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg px-3 py-2 text-white placeholder-gray-300">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">عدد الرحلات في الأسبوع</label>
                                <input type="number" id="trips" placeholder="عدد الرحلات" value="5"
                                       class="w-full bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg px-3 py-2 text-white placeholder-gray-300">
                            </div>
                            <button id="calculateCarbon" class="w-full bg-green-600 hover:bg-green-700 py-3 rounded-lg font-medium transition-colors">
                                احسب البصمة الكربونية
                            </button>
                        </div>
                    </div>

                    <!-- Results and Suggestions -->
                    <div class="space-y-6">
                        <!-- Carbon Results -->
                        <div class="bg-gradient-to-br from-green-600 to-teal-600 rounded-xl p-6">
                            <h3 class="text-lg font-bold mb-4">📊 نتائج الحساب</h3>
                            <div class="text-center">
                                <div class="text-4xl font-bold mb-2" id="carbonResult">0 كجم</div>
                                <div class="text-sm opacity-80">CO₂ أسبوعياً</div>
                                <div class="mt-4 text-sm">
                                    <div class="flex justify-between mb-2">
                                        <span>هدف الشهر:</span>
                                        <span>50 كجم</span>
                                    </div>
                                    <div class="w-full bg-white bg-opacity-20 rounded-full h-2">
                                        <div id="carbonProgress" class="bg-white h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Eco-friendly Alternatives -->
                        <div class="bg-white bg-opacity-10 rounded-xl p-6">
                            <h3 class="text-lg font-bold mb-4">🌿 بدائل صديقة للبيئة</h3>
                            <div id="ecoAlternatives" class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-white bg-opacity-10 rounded-lg">
                                    <div class="flex items-center">
                                        <span class="text-2xl ml-3">🚇</span>
                                        <div>
                                            <div class="font-medium">استخدم المترو</div>
                                            <div class="text-sm opacity-80">وفر 80% من الانبعاثات</div>
                                        </div>
                                    </div>
                                    <div class="text-green-400 font-bold">-15 كجم</div>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-white bg-opacity-10 rounded-lg">
                                    <div class="flex items-center">
                                        <span class="text-2xl ml-3">🚲</span>
                                        <div>
                                            <div class="font-medium">اركب الدراجة</div>
                                            <div class="text-sm opacity-80">صفر انبعاثات + صحة أفضل</div>
                                        </div>
                                    </div>
                                    <div class="text-green-400 font-bold">-20 كجم</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Carbon Offset Projects -->
                <div class="mt-6 bg-white bg-opacity-10 rounded-xl p-6">
                    <h3 class="text-lg font-bold mb-4">🌳 مشاريع تعويض الكربون</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                            <div class="text-3xl mb-2">🌲</div>
                            <h4 class="font-bold mb-2">زراعة الأشجار</h4>
                            <p class="text-sm opacity-80 mb-3">ازرع شجرة لتعويض 22 كجم CO₂ سنوياً</p>
                            <button class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm transition-colors">
                                ازرع شجرة - 50 جنيه
                            </button>
                        </div>
                        <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                            <div class="text-3xl mb-2">☀</div>
                            <h4 class="font-bold mb-2">الطاقة الشمسية</h4>
                            <p class="text-sm opacity-80 mb-3">ادعم مشاريع الطاقة المتجددة</p>
                            <button class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded-lg text-sm transition-colors">
                                ادعم المشروع - 100 جنيه
                            </button>
                        </div>
                        <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                            <div class="text-3xl mb-2">💧</div>
                            <h4 class="font-bold mb-2">المياه النظيفة</h4>
                            <p class="text-sm opacity-80 mb-3">وفر مياه نظيفة وقلل الانبعاثات</p>
                            <button class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm transition-colors">
                                ساهم - 75 جنيه
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 6: Community -->
        <div id="community" class="section-content">
            <div class="section-card rounded-2xl p-6 mb-6">
                <h2 class="text-2xl font-bold mb-6 text-center">👥 مجتمع مراقبي الطقس</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Add Note Form -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6">
                        <h3 class="text-lg font-bold mb-4">📝 شارك ملاحظتك</h3>
                        <form id="noteForm">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">المدينة</label>
                                    <select id="noteCity" class="w-full bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg px-3 py-2 text-white">
                                        <option value="القاهرة">القاهرة 🇪🇬</option>
                                        <option value="دبي">دبي 🇦🇪</option>
                                        <option value="لندن">لندن 🇬🇧</option>
                                        <option value="نيويورك">نيويورك 🇺🇸</option>
                                        <option value="طوكيو">طوكيو 🇯🇵</option>
                                        <option value="باريس">باريس 🇫🇷</option>
                                        <option value="الرياض">الرياض 🇸🇦</option>
                                        <option value="إسطنبول">إسطنبول 🇹🇷</option>
                                        <option value="برلين">برلين 🇩🇪</option>
                                        <option value="سيدني">سيدني 🇦🇺</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">نوع الملاحظة</label>
                                    <select id="noteType" class="w-full bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg px-3 py-2 text-white">
                                        <option value="weather">حالة الطقس</option>
                                        <option value="pollution">مستوى التلوث</option>
                                        <option value="warning">تحذير</option>
                                        <option value="tip">نصيحة</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">الملاحظة</label>
                                    <textarea id="noteText" rows="3" class="w-full bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg px-3 py-2 text-white placeholder-gray-300" placeholder="شارك ملاحظتك عن الطقس..."></textarea>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 py-2 rounded-lg font-medium transition-colors">
                                    نشر الملاحظة (+10 نقاط)
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Community Feed -->
                    <div class="lg:col-span-2">
                        <div class="bg-white bg-opacity-10 rounded-xl p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-bold">📢 آخر الملاحظات</h3>
                                <div class="flex space-x-2 space-x-reverse">
                                    <button id="filterAll" class="filter-btn active px-3 py-1 rounded-lg text-sm bg-blue-600">الكل</button>
                                    <button id="filterWeather" class="filter-btn px-3 py-1 rounded-lg text-sm bg-white bg-opacity-20">طقس</button>
                                    <button id="filterPollution" class="filter-btn px-3 py-1 rounded-lg text-sm bg-white bg-opacity-20">تلوث</button>
                                    <button id="filterWarning" class="filter-btn px-3 py-1 rounded-lg text-sm bg-white bg-opacity-20">تحذيرات</button>
                                </div>
                            </div>
                            
                            <div class="notes-container space-y-4 max-h-96 overflow-y-auto" id="userNotes">
                                <div class="note-item bg-white bg-opacity-10 rounded-lg p-4" data-type="weather">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="flex items-center">
                                            <span class="font-semibold text-blue-300">أحمد محمد</span>
                                            <span class="mx-2 text-gray-400">•</span>
                                            <span class="text-sm text-gray-400">دبي 🇦🇪</span>
                                            <span class="mx-2 text-gray-400">•</span>
                                            <span class="text-xs bg-blue-600 px-2 py-1 rounded-full">طقس</span>
                                        </div>
                                        <span class="text-xs opacity-60">منذ ساعتين</span>
                                    </div>
                                    <p class="text-sm mb-3">الجو حار جداً اليوم، ننصح بتجنب الخروج وقت الظهيرة وشرب الكثير من الماء</p>
                                    <div class="flex items-center space-x-4 space-x-reverse text-xs">
                                        <button class="flex items-center text-green-400 hover:text-green-300">
                                            👍 مفيد (12)
                                        </button>
                                        <button class="flex items-center text-blue-400 hover:text-blue-300">
                                            💬 تعليق
                                        </button>
                                        <button class="flex items-center text-purple-400 hover:text-purple-300">
                                            📤 مشاركة
                                        </button>
                                    </div>
                                </div>

                                <div class="note-item bg-white bg-opacity-10 rounded-lg p-4" data-type="warning">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="flex items-center">
                                            <span class="font-semibold text-red-300">فاطمة علي</span>
                                            <span class="mx-2 text-gray-400">•</span>
                                            <span class="text-sm text-gray-400">لندن 🇬🇧</span>
                                            <span class="mx-2 text-gray-400">•</span>
                                            <span class="text-xs bg-red-600 px-2 py-1 rounded-full">تحذير</span>
                                        </div>
                                        <span class="text-xs opacity-60">منذ 4 ساعات</span>
                                    </div>
                                    <p class="text-sm mb-3">⚠ رياح قوية جداً وأمطار غزيرة، تجنبوا الخروج إلا للضرورة</p>
                                    <div class="flex items-center space-x-4 space-x-reverse text-xs">
                                        <button class="flex items-center text-green-400 hover:text-green-300">
                                            👍 مفيد (8)
                                        </button>
                                        <button class="flex items-center text-blue-400 hover:text-blue-300">
                                            💬 تعليق
                                        </button>
                                        <button class="flex items-center text-purple-400 hover:text-purple-300">
                                            📤 مشاركة
                                        </button>
                                    </div>
                                </div>

                                <div class="note-item bg-white bg-opacity-10 rounded-lg p-4" data-type="pollution">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="flex items-center">
                                            <span class="font-semibold text-yellow-300">محمد حسن</span>
                                            <span class="mx-2 text-gray-400">•</span>
                                            <span class="text-sm text-gray-400">طوكيو 🇯🇵</span>
                                            <span class="mx-2 text-gray-400">•</span>
                                            <span class="text-xs bg-yellow-600 px-2 py-1 rounded-full">تلوث</span>
                                        </div>
                                        <span class="text-xs opacity-60">منذ 6 ساعات</span>
                                    </div>
                                    <p class="text-sm mb-3">مستوى التلوث عالي جداً اليوم، أنصح بارتداء الكمامة عند الخروج</p>
                                    <div class="flex items-center space-x-4 space-x-reverse text-xs">
                                        <button class="flex items-center text-green-400 hover:text-green-300">
                                            👍 مفيد (15)
                                        </button>
                                        <button class="flex items-center text-blue-400 hover:text-blue-300">
                                            💬 تعليق
                                        </button>
                                        <button class="flex items-center text-purple-400 hover:text-purple-300">
                                            📤 مشاركة
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Community Stats -->
                <div class="mt-6 grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold mb-1">1,247</div>
                        <div class="text-sm opacity-80">عضو نشط</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-600 to-teal-600 rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold mb-1">3,891</div>
                        <div class="text-sm opacity-80">ملاحظة مشاركة</div>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-600 to-orange-600 rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold mb-1">156</div>
                        <div class="text-sm opacity-80">تحذير هذا الأسبوع</div>
                    </div>
                    <div class="bg-gradient-to-br from-red-600 to-pink-600 rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold mb-1">94.2%</div>
                        <div class="text-sm opacity-80">دقة التوقعات</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="cityModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gradient-to-br from-blue-900 to-purple-900 rounded-2xl p-6 max-w-md w-full mx-4 border border-white border-opacity-20">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold" id="modalCityName">القاهرة</h3>
                <button id="closeModal" class="text-white hover:text-gray-300">✕</button>
            </div>
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-red-400" id="modalTemp">38°C</div>
                        <div class="text-sm opacity-80">درجة الحرارة</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-yellow-400" id="modalPollution">85</div>
                        <div class="text-sm opacity-80">مؤشر التلوث</div>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-400" id="modalHumidity">45%</div>
                    <div class="text-sm opacity-80">الرطوبة</div>
                </div>
                <button id="askAIAboutCity" class="w-full bg-purple-600 hover:bg-purple-700 py-2 rounded-lg font-medium transition-colors">
                    🤖 اسأل الذكاء الاصطناعي عن هذه المدينة
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let map;
        let cityMarkers = [];
        let currentSection = 'satellite';
        let isAITyping = false;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeNavigation();
            initializeMap();
            initializeCharts();
            initializeAI();
            setupEventListeners();
            startRealTimeUpdates();
        });

        // Navigation system
        function initializeNavigation() {
            const navTabs = document.querySelectorAll('.nav-tab');
            const sections = document.querySelectorAll('.section-content');

            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetSection = this.dataset.section;
                    
                    // Update active tab
                    navTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update active section
                    sections.forEach(s => s.classList.remove('active'));
                    document.getElementById(targetSection).classList.add('active');
                    
                    currentSection = targetSection;
                    
                    // Initialize section-specific features
                    if (targetSection === 'map' && !map) {
                        setTimeout(initializeMap, 100);
                    }
                    if (targetSection === 'analytics') {
                        setTimeout(initializeCharts, 100);
                    }
                });
            });
        }

        // AI Chat System with Real API Integration
        function initializeAI() {
            const chatInput = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            const quickQuestions = document.querySelectorAll('.quick-question');

            // Send message function
            async function sendMessage(message) {
                if (!message.trim() || isAITyping) return;

                addMessageToChat(message, 'user');
                chatInput.value = '';
                
                // Show typing indicator
                showTypingIndicator();
                
                try {
                    // Simulate AI response (replace with real API call)
                    const response = await getAIResponse(message);
                    hideTypingIndicator();
                    addMessageToChat(response, 'ai');
                } catch (error) {
                    hideTypingIndicator();
                    addMessageToChat('عذراً، حدث خطأ في الاتصال بالذكاء الاصطناعي. يرجى المحاولة مرة أخرى.', 'ai');
                }
            }

            // Real AI API integration with multiple providers
            async function getAIResponse(message) {
                try {
                    // Try OpenAI GPT first
                    const openAIResponse = await callOpenAI(message);
                    if (openAIResponse) return openAIResponse;
                    
                    // Fallback to Gemini
                    const geminiResponse = await callGemini(message);
                    if (geminiResponse) return geminiResponse;
                    
                    // Fallback to local processing
                    return await getLocalAIResponse(message);
                    
                } catch (error) {
                    console.error('AI API Error:', error);
                    return await getLocalAIResponse(message);
                }
            }

            // OpenAI GPT Integration
            async function callOpenAI(message) {
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer YOUR_OPENAI_API_KEY' // Replace with your API key
                        },
                        body: JSON.stringify({
                            model: "gpt-3.5-turbo",
                            messages: [
                                {
                                    role: "system",
                                    content: `أنت مساعد ذكي متخصص في الطقس والبيئة. تجيب باللغة العربية وتقدم معلومات دقيقة عن:
                                    - أحوال الطقس في جميع أنحاء العالم
                                    - توقعات الطقس
                                    - نصائح الحماية من الطقس السيء
                                    - معلومات عن التلوث وجودة الهواء
                                    - نصائح بيئية
                                    
                                    اجعل إجاباتك مفيدة ومفصلة ومنظمة بشكل جميل مع استخدام الرموز التعبيرية.`
                                },
                                {
                                    role: "user",
                                    content: message
                                }
                            ],
                            max_tokens: 500,
                            temperature: 0.7
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        return data.choices[0].message.content;
                    }
                } catch (error) {
                    console.error('OpenAI API Error:', error);
                }
                return null;
            }

            // Google Gemini Integration
            async function callGemini(message) {
                try {
                    const response = await fetch(https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=YOUR_GEMINI_API_KEY, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: أنت مساعد ذكي متخصص في الطقس والبيئة. أجب على السؤال التالي باللغة العربية بشكل مفصل ومفيد: ${message}
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 500
                            }
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        return data.candidates[0].content.parts[0].text;
                    }
                } catch (error) {
                    console.error('Gemini API Error:', error);
                }
                return null;
            }

            // Local AI processing as fallback
            async function getLocalAIResponse(message) {
                const weatherKeywords = ['طقس', 'حرارة', 'مطر', 'رياح', 'رطوبة', 'weather', 'temperature', 'rain'];
                const worldCities = ['القاهرة', 'دبي', 'لندن', 'نيويورك', 'طوكيو', 'باريس', 'الرياض', 'إسطنبول', 'برلين', 'سيدني'];
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                if (weatherKeywords.some(keyword => message.includes(keyword))) {
                    const city = worldCities.find(city => message.includes(city));
                    if (city) {
                        return await getWeatherFromAPI(city);
                    } else {
                        return "يرجى تحديد المدينة التي تريد معرفة طقسها. يمكنني تقديم معلومات عن مدن حول العالم مثل القاهرة، دبي، لندن، نيويورك، طوكيو، باريس، والرياض.";
                    }
                } else if (message.includes('نصائح') || message.inclu